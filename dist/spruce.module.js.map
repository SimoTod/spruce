{"version":3,"file":"spruce.module.js","sources":["../src/utils.js","../src/observable.js","../src/index.js"],"sourcesContent":["export const domReady = () => {\n    return new Promise(resolve => {\n        if (document.readyState == \"loading\") {\n            document.addEventListener(\"DOMContentLoaded\", resolve)\n        } else {\n            resolve()\n        }\n    })\n}\n\nexport const buildInitExpression = el => {\n    let expression = \"$store = Spruce.subscribe($el)\"\n\n    if (el.hasAttribute('x-init')) {\n        expression = `${expression}; ${el.getAttribute('x-init')}`\n    }\n\n    return expression\n}\n\nexport const isNullOrUndefined = value => {\n    return value === null || value === undefined\n}","import { isNullOrUndefined } from './utils'\n\nexport const createObservable = (target, callbacks) => {\n    Object.keys(target).forEach(key => {\n        if (! isNullOrUndefined(target[key]) && Object.getPrototypeOf(target[key]) === Object.prototype) {\n            target[key] = createObservable(target[key], callbacks)\n        }\n    })\n\n    return new Proxy(target, {\n        get(target, key) {\n            if (callbacks.hasOwnProperty('get')) {\n                callbacks.get(key)\n            }\n            \n            return target[key]\n        },\n        set(target, key, value) {\n            if (! isNullOrUndefined(value) && typeof value === 'object') {\n                value = createObservable(value, callbacks)\n            }\n\n            callbacks.set(key, target[key] = value)\n\n            return true\n        }\n    })\n}","import { domReady, buildInitExpression } from './utils'\nimport { createObservable } from './observable'\n\nconst Spruce = {\n    options: {\n        globalStoreVariable: false,\n    },\n\n    stores: {},\n\n    subscribers: [],\n\n    start: async function () {\n        await domReady()\n\n        document.querySelectorAll('[x-subscribe]').forEach(el => {\n            el.setAttribute('x-init', buildInitExpression(el))\n            el.removeAttribute('x-subscribe')\n        })\n\n        this.stores = createObservable(this.stores, {\n            set: (key, value) => {\n                this.updateSubscribers(key, value)\n            }\n        })\n\n        if (this.options.globalStoreVariable) {\n            document.querySelectorAll('[x-data]').forEach(el => {\n                if (! this.subscribers.includes(el)) {\n                    this.subscribers.push(el)\n                }\n            })\n            \n            window.$store = this.stores\n        }\n    },\n\n    store: function (name, state = {}) {\n        if (! this.stores[name]) {\n            this.stores[name] = state\n        }\n    },\n\n    subscribe(el) {\n        this.subscribers.push(el)\n\n        return this.stores\n    },\n\n    updateSubscribers(key, value) {\n        this.subscribers.forEach(el => {\n            if (el.__x !== undefined) {\n                el.__x.$data.spruce = value\n            }\n        })\n    },\n\n    config(options = {}) {\n        this.options = Object.assign(this.options, options)\n    }\n}\n\nconst deferrer = window.deferLoadingAlpine || function (callback) { callback() }\n\nwindow.deferLoadingAlpine = function (callback) {\n    window.Spruce = Spruce\n    window.Spruce.start()\n\n    deferrer(callback)\n}\n\nexport default Spruce"],"names":["const","isNullOrUndefined","value","createObservable","target","callbacks","Object","keys","forEach","key","getPrototypeOf","prototype","Proxy","get","hasOwnProperty","set","Spruce","options","globalStoreVariable","stores","subscribers","start","this","Promise","resolve","document","readyState","addEventListener","querySelectorAll","el","setAttribute","expression","hasAttribute","getAttribute","buildInitExpression","removeAttribute","_this","updateSubscribers","includes","push","window","$store","store","name","state","subscribe","undefined","__x","$data","spruce","config","assign","deferrer","deferLoadingAlpine","callback"],"mappings":"AAAOA,IAoBMC,WAAoBC,UACtBA,MAAAA,GCnBEC,WAAoBC,EAAQC,UACrCC,OAAOC,KAAKH,GAAQI,iBAAQC,GAClBR,EAAkBG,EAAOK,KAASH,OAAOI,eAAeN,EAAOK,MAAUH,OAAOK,YAClFP,EAAOK,GAAON,EAAiBC,EAAOK,GAAMJ,MAI7C,IAAIO,MAAMR,EAAQ,CACrBS,aAAIT,EAAQK,UACJJ,EAAUS,eAAe,QACzBT,EAAUQ,IAAIJ,GAGXL,EAAOK,IAElBM,aAAIX,EAAQK,EAAKP,UACPD,EAAkBC,IAA2B,iBAAVA,IACrCA,EAAQC,EAAiBD,EAAOG,IAGpCA,EAAUU,IAAIN,EAAKL,EAAOK,GAAOP,IAE1B,MCrBbc,EAAS,CACXC,QAAS,CACLC,qBAAqB,GAGzBC,OAAQ,GAERC,YAAa,GAEbC,2BAQIC,4BFnBG,IAAIC,iBAAQC,GACY,WAAvBC,SAASC,WACTD,SAASE,iBAAiB,mBAAoBH,GAE9CA,uBEUJC,SAASG,iBAAiB,iBAAiBpB,iBAAQqB,GAC/CA,EAAGC,aAAa,kBFNOD,OAC3BE,EAAa,wCAEbF,EAAGG,aAAa,YAChBD,EAAgBA,OAAeF,EAAGI,aAAa,WAG5CF,EED2BG,CAAoBL,IAC9CA,EAAGM,gBAAgB,mBAGlBhB,OAAShB,EAAiBiC,EAAKjB,OAAQ,CACxCJ,aAAMN,EAAKP,KACFmC,kBAAkB5B,EAAKP,MAIhCkC,EAAKnB,QAAQC,sBACbO,SAASG,iBAAiB,YAAYpB,iBAAQqB,GACpCO,EAAKhB,YAAYkB,SAAST,MACvBT,YAAYmB,KAAKV,KAI9BW,OAAOC,OAASL,EAAKjB,8CAI7BuB,MAAO,SAAUC,EAAMC,kBAAQ,IACrBtB,KAAKH,OAAOwB,UACTxB,OAAOwB,GAAQC,IAI5BC,mBAAUhB,eACDT,YAAYmB,KAAKV,GAEfP,KAAKH,QAGhBkB,2BAAkB5B,EAAKP,QACdkB,YAAYZ,iBAAQqB,QACNiB,IAAXjB,EAAGkB,MACHlB,EAAGkB,IAAIC,MAAMC,OAAS/C,MAKlCgD,gBAAOjC,kBAAU,SACRA,QAAUX,OAAO6C,OAAO7B,KAAKL,QAASA,KAI7CmC,EAAWZ,OAAOa,oBAAsB,SAAUC,GAAYA,KAEpEd,OAAOa,mBAAqB,SAAUC,GAClCd,OAAOxB,OAASA,EAChBwB,OAAOxB,OAAOK,QAEd+B,EAASE"}